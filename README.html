<p>One common need when working in PHP is a way to convert an XML document into a serializable array. If you ever tried to serialize() and then unserialize() a SimpleXML or DOMDocument object, you know what I'm talking about.</p>

<p>Assume the following XML snippet:</p> 

<blockquote>&lt;tv&gt;
&nbsp;&nbsp;&lt;show name=&quot;Family Guy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;dog&gt;Brian&lt;/dog&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;kid&gt;Chris&lt;/kid&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;kid&gt;Meg&lt;/kid&gt;
&nbsp;&nbsp;&lt;/show&gt;
&lt;/tv&gt;</blockquote>

<p>There's a quick and dirty way to do convert such a document to an array, using type casting and the JSON functions to ensure there are no exotic values that would cause problems when unserializing:</p>

<pre>&lt;?php
  $a = json_decode(json_encode((array) simplexml_load_string($s)),1);
?&gt;</pre>

<p>Here is the result for our sample XML, eg if we <code>print_r($a)</code>:</p>

<pre>Array
(
    [show] =&gt; Array
        (
            [@attributes] =&gt; Array
                (
                    [name] =&gt; Family Guy
                )
            [dog] =&gt; Brian
            [kid] =&gt; Array
                (
                    [0] =&gt; Chris
                    [1] =&gt; Meg
                )
        )
)</pre>

<p>Pretty nifty, eh? But maybe we want to embed some HTML tags or something crazy along those lines.  then we need a CDATA node...</p>

<blockquote>&lt;tv&gt;
&nbsp;&nbsp;&lt;show name=&quot;Family Guy&quot;&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;dog&gt;Brian&lt;/dog&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;kid&gt;Chris&lt;/kid&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;kid&gt;Meg&lt;/kid&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&lt;kid&gt;&lt;![CDATA[&lt;em&gt;Stewie&lt;/em&gt;]]&gt;&lt;/kid&gt;
&nbsp;&nbsp;&lt;/show&gt;
&lt;/tv&gt;</blockquote>

<p>The snippet of XML above would yield the following:</p>

<pre>Array
(
    [show] =&gt; Array
        (
            [@attributes] =&gt; Array
                (
                    [name] =&gt; Family Guy
                )
            [dog] =&gt; Brian
            [kid] =&gt; Array
                (
                    [0] =&gt; Chris
                    [1] =&gt; Meg
                    [2] =&gt; Array
                        (
                        )
                )
        )
)</pre>

<p>That's not very useful. We got in trouble because the CDATA node, a SimpleXMLElement, is being cast to an array instead of a string. To handle this case while still keeping the nice @attributes notation, we need a slightly more verbose conversion function. Here is my version, hereby released under a do-whatever-but-dont-sue-me license.</p>

<pre>&lt;?php
/**
 * convert xml string to php array - useful to get a serializable value
 *
 * @param string $xmlstr 
 * @return array
 * @author Adrien aka Gaarf
 */
function xmlstr_to_array($xmlstr) {
  $doc = new DOMDocument();
  $doc-&gt;loadXML($xmlstr);
  return domnode_to_array($doc-&gt;documentElement);
}
function domnode_to_array($node) {
  $output = array();
  switch ($node-&gt;nodeType) {
   case XML_CDATA_SECTION_NODE:
   case XML_TEXT_NODE:
    $output = trim($node-&gt;textContent);
   break;
   case XML_ELEMENT_NODE:
    for ($i=0, $m=$node-&gt;childNodes-&gt;length; $i&lt;$m; $i++) { 
     $child = $node-&gt;childNodes-&gt;item($i);
     $v = domnode_to_array($child);
     if(isset($child-&gt;tagName)) {
       $t = $child-&gt;tagName;
       if(!isset($output[$t])) {
        $output[$t] = array();
       }
       $output[$t][] = $v;
     }
     elseif($v) {
      $output = (string) $v;
     }
    }
    if(is_array($output)) {
     if($node-&gt;attributes-&gt;length) {
      $a = array();
      foreach($node-&gt;attributes as $attrName =&gt; $attrNode) {
       $a[$attrName] = (string) $attrNode-&gt;value;
      }
      $output[&#x27;@attributes&#x27;] = $a;
     }
     foreach ($output as $t =&gt; $v) {
      if(is_array($v) &amp;&amp; count($v)==1 &amp;&amp; $t!=&#x27;@attributes&#x27;) {
       $output[$t] = $v[0];
      }
     }
    }
   break;
  }
  return $output;
}
?&gt;</pre>

<p>and the result, for our <em>Stewie</em> snippet:</p>

<pre>Array
(
    [show] =&gt; Array
        (
            [@attributes] =&gt; Array
                (
                    [name] =&gt; Family Guy
                )
            [dog] =&gt; Brian
            [kid] =&gt; Array
                (
                    [0] =&gt; Chris
                    [1] =&gt; Meg
                    [2] =&gt; &lt;em&gt;Stewie&lt;/em&gt;
                )
        )
)</pre>

<p>Victory is mine! :D</p>